<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>JobTracker â€“ Calendar</title>
    <script>
      // Apply theme immediately to prevent flash
      (function() {
        const theme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', theme);
      })();
      
      // Set up date input constraints and validation
      document.addEventListener('DOMContentLoaded', function() {
        // Minimum date: 1900-01-01
        const minDate = '1900-01-01';
        // Maximum date: 3 years from now
        const today = new Date();
        const maxDate = new Date(today.getFullYear() + 3, today.getMonth(), today.getDate());
        const maxDateString = maxDate.toISOString().split('T')[0];
        
        // Apply constraints to all date inputs
        const dateInputs = document.querySelectorAll('input[type="date"]');
        dateInputs.forEach(input => {
          input.setAttribute('min', minDate);
          input.setAttribute('max', maxDateString);
          
          // Add validation on blur to catch manually typed invalid dates
          input.addEventListener('blur', function() {
            validateDateInput(this, minDate, maxDateString);
          });
          
          // Also validate on change
          input.addEventListener('change', function() {
            validateDateInput(this, minDate, maxDateString);
          });
        });
      });
      
      function validateDateInput(input, minDateStr, maxDateStr) {
        if (!input.value) return; // Allow empty
        
        const inputDate = new Date(input.value + 'T00:00:00Z');
        const minDate = new Date(minDateStr + 'T00:00:00Z');
        const maxDate = new Date(maxDateStr + 'T00:00:00Z');
        
        // Check if date is valid
        if (isNaN(inputDate.getTime())) {
          input.style.borderColor = '#ef4444';
          input.title = 'Invalid date format';
          return false;
        }
        
        // Check if date is within range
        if (inputDate < minDate) {
          input.style.borderColor = '#ef4444';
          input.title = 'Date cannot be before January 1, 1900';
          return false;
        }
        
        if (inputDate > maxDate) {
          input.style.borderColor = '#ef4444';
          input.title = `Date cannot be more than 3 years in the future`;
          return false;
        }
        
        // Valid date - reset styling
        input.style.borderColor = '';
        input.title = '';
        return true;
      }
    </script>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="app-shell">
      <aside class="sidebar">
        <div class="sidebar-logo">JobTracker</div>
        <p class="nav-section-title">Menu</p>
        <ul class="nav-list">
          <li class="nav-item">
            <a href="dashboard.html" class="nav-link">
              <span class="icon icon-dashboard"></span>
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a href="index.html" class="nav-link">
              <span class="icon icon-applications"></span>
              Applications
            </a>
          </li>
          <li class="nav-item">
            <a href="recommendations.html" class="nav-link">
              <span class="icon icon-recommendations"></span>
              Recommendations
            </a>
          </li>
          <li class="nav-item">
            <a href="calendar.html" class="nav-link active">
              <span class="icon icon-calendar"></span>
              Calendar View
            </a>
          </li>
          <li class="nav-item">
            <a href="settings.html" class="nav-link">
              <span class="icon icon-settings"></span>
              Settings
            </a>
          </li>
        </ul>
      </aside>

      <div class="main-area">
        <div id="navbar-container"></div>

        <main class="content" id="calendar-root">
          <div class="page-header">
            <div class="page-title-group">
              <h1>Calendar</h1>
              <p>Deadlines &amp; Interviews</p>
            </div>
            <div class="calendar-controls">
              <button class="primary-btn" id="add-event-btn">+ Add Event</button>
              <div class="pill-filters">
                <button class="pill-btn active" data-view="month">Month</button>
                <button class="pill-btn" data-view="week">Week</button>
                <button class="pill-btn" data-view="day">Day</button>
              </div>
            </div>
          </div>

          <section class="card">
            <div class="calendar-header">
              <button class="calendar-nav-btn" id="prev-btn">&larr;</button>
              <div class="calendar-title-group">
                <span id="calendar-month-label"></span>
                <button class="today-btn" id="today-btn">Today</button>
              </div>
              <button class="calendar-nav-btn" id="next-btn">&rarr;</button>
            </div>

            <!-- Month View -->
            <div id="month-view" class="calendar-view">
              <table class="calendar-grid">
                <thead>
                  <tr>
                    <th>SUN</th>
                    <th>MON</th>
                    <th>TUE</th>
                    <th>WED</th>
                    <th>THU</th>
                    <th>FRI</th>
                    <th>SAT</th>
                  </tr>
                </thead>
                <tbody id="calendar-tbody"></tbody>
              </table>
            </div>

            <!-- Week View -->
            <div id="week-view" class="calendar-view" style="display: none;">
              <div class="week-header">
                <div class="week-time-column"></div>
                <div class="week-days-header" id="week-days-header"></div>
              </div>
              <div class="week-grid-container">
                <div class="week-time-labels" id="week-time-labels"></div>
                <div class="week-grid" id="week-grid"></div>
              </div>
            </div>

            <!-- Day View -->
            <div id="day-view" class="calendar-view" style="display: none;">
              <div class="day-header">
                <div class="day-time-column"></div>
                <div class="day-date-header" id="day-date-header"></div>
              </div>
              <div class="day-grid-container">
                <div class="day-time-labels" id="day-time-labels"></div>
                <div class="day-grid" id="day-grid"></div>
              </div>
            </div>
          </section>
        </main>
      </div>
    </div>

    <!-- Event Modal -->
    <div id="event-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="event-modal-title">Add Event</h2>
          <span class="modal-close">&times;</span>
        </div>
        <form id="event-form">
          <div class="form-group">
            <label for="event-type">Event Type</label>
            <select id="event-type" required>
              <option value="DEADLINE">Application Deadline</option>
              <option value="INTERVIEW">Interview/Screen</option>
              <option value="FOLLOWUP">Assignment / Follow Up</option>
            </select>
          </div>

          <div class="form-group">
            <label for="event-title">Title</label>
            <input type="text" id="event-title" placeholder="Event title" required />
          </div>

          <div class="form-group">
            <label for="event-application-dropdown">Application (Optional)</label>
            <select id="event-application-dropdown">
              <option value="">-- No Application --</option>
            </select>
          </div>

          <!-- Application-specific fields -->
          <div id="application-fields" style="display: block;">
            <div class="form-group">
              <label for="event-deadline">Deadline</label>
              <input type="date" id="event-deadline" />
            </div>
          </div>

          <!-- Interview-specific fields -->
          <div id="interview-fields" style="display: none;">
            <div class="form-group">
              <label for="event-start-date">Start Date</label>
              <input type="date" id="event-start-date" />
            </div>
            <div class="form-group">
              <label for="event-end-date">End Date (Optional)</label>
              <input type="date" id="event-end-date" />
            </div>
          </div>

          <!-- Assignment-specific fields -->
          <div id="assignment-fields" style="display: none;">
            <div class="form-group">
              <label for="event-assignment-deadline">Deadline</label>
              <input type="date" id="event-assignment-deadline" />
            </div>
          </div>

          <!-- Optional time fields (available for all event types) -->
          <div id="time-fields" style="display: block;">
            <!-- For DEADLINE and FOLLOWUP: single time field -->
            <div id="single-time-field" style="display: block;">
              <div class="form-group">
                <label for="event-time">Time (Optional)</label>
                <input type="time" id="event-time" />
              </div>
              <div class="form-group">
                <label for="event-location">Location (Optional)</label>
                <input type="text" id="event-location" placeholder="Office, address, etc." />
              </div>
            </div>
            
            <!-- For INTERVIEW: start and end times -->
            <div id="interview-time-fields" style="display: none;">
              <div class="form-row">
                <div class="form-group">
                  <label for="event-start-time">Start Time</label>
                  <input type="time" id="event-start-time" />
                </div>
                <div class="form-group">
                  <label for="event-end-time">End Time</label>
                  <input type="time" id="event-end-time" />
                </div>
              </div>
              <div class="form-group">
                <label for="event-meeting-link">Meeting Link (Optional)</label>
                <input type="url" id="event-meeting-link" placeholder="Zoom, Google Meet, etc." />
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="event-color">Color</label>
            <select id="event-color">
              <option value="red">Red</option>
              <option value="orange">Orange</option>
              <option value="green">Green</option>
              <option value="blue">Blue</option>
              <option value="purple">Purple</option>
            </select>
          </div>

          <div class="form-group">
            <label for="event-notes">Notes</label>
            <textarea id="event-notes" rows="3" placeholder="Additional notes..."></textarea>
          </div>

          <div class="modal-actions">
            <button type="button" id="event-delete-btn" class="danger-btn">Delete</button>
            <div class="modal-actions-right">
              <button type="button" class="secondary-btn modal-close">Cancel</button>
              <button type="button" id="event-submit-btn" class="primary-btn">Save Event</button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <script src="app.js"></script>
  </body>
</html>