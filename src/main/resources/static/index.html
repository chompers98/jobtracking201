<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>JobTracker â€“ Applications</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="app-shell">
      <aside class="sidebar">
        <div class="sidebar-logo">JobTracker</div>
        <p class="nav-section-title">Menu</p>
        <ul class="nav-list">
          <li class="nav-item">
            <a href="dashboard.html" class="nav-link">
              <span class="icon icon-dashboard"></span>
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a href="index.html" class="nav-link active">
              <span class="icon icon-applications"></span>
              Applications
            </a>
          </li>
          <li class="nav-item">
            <a href="recommendations.html" class="nav-link">
              <span class="icon icon-recommendations"></span>
              Recommendations
            </a>
          </li>
          <li class="nav-item">
            <a href="calendar.html" class="nav-link">
              <span class="icon icon-calendar"></span>
              Calendar View
            </a>
          </li>
          <li class="nav-item">
            <a href="integrations.html" class="nav-link">
              <span class="icon icon-integrations"></span>
              Integrations
            </a>
          </li>
          <li class="nav-item">
            <a href="settings.html" class="nav-link">
              <span class="icon icon-settings"></span>
              Settings
            </a>
          </li>
        </ul>
      </aside>

      <div class="main-area">
        <header class="top-bar">
          <div class="top-bar-right">
            <span id="username-display">User</span>
            <button id="logout-btn" class="logout-btn">Logout</button>
            <div class="avatar" id="avatar-display">U</div>
          </div>
        </header>

        <main class="content">
          <div class="page-header">
            <div class="page-title-group">
              <h1>Job Applications</h1>
              <p>Manage all your job applications</p>
            </div>
            <button
              class="primary-btn"
              onclick="window.location.href='new_application.html'"
            >
              + New Application
            </button>
          </div>

          <section class="card">
            <div class="table-toolbar">
              <div class="search-input">
                <input
                  id="search-input"
                  type="text"
                  placeholder="Search applications..."
                />
              </div>
              <div class="pill-filters">
                <button class="pill-btn active" data-filter="all">All</button>
                <button class="pill-btn" data-filter="active">Active</button>
                <button class="pill-btn" data-filter="archived">
                  Archived
                </button>
              </div>
            </div>

            <table class="app-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Company</th>
                  <th>Title</th>
                  <th>Status</th>
                  <th>Deadline</th>
                  <th>Link</th>
                </tr>
              </thead>
              <tbody id="applications-tbody"></tbody>
            </table>

            <div class="table-footer">
              <span id="applications-count" class="muted"></span>
              <div class="pagination">
                <button class="active">1</button>
                <button>2</button>
                <button>3</button>
              </div>
            </div>
          </section>
        </main>
      </div>
    </div>

    <script>
      // Check if user is authenticated
      function checkAuthentication() {
        const jwtToken = localStorage.getItem('jwtToken');
        if (!jwtToken) {
          // Redirect to login if not authenticated
          window.location.href = '/login.html';
          return false;
        }
        return true;
      }

      // Load user info and display
      function loadUserInfo() {
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        const usernameDisplay = document.getElementById('username-display');
        const avatarDisplay = document.getElementById('avatar-display');
        
        if (user.username) {
          usernameDisplay.textContent = user.username;
          avatarDisplay.textContent = user.username.substring(0, 2).toUpperCase();
        }
      }

      // Setup logout
      document.getElementById('logout-btn').addEventListener('click', async function() {
        try {
          const jwtToken = localStorage.getItem('jwtToken');
          await fetch('/api/auth/logout', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${jwtToken}`
            }
          });
        } catch (error) {
          console.error('Logout error:', error);
        } finally {
          // Clear localStorage
          localStorage.removeItem('jwtToken');
          localStorage.removeItem('refreshToken');
          localStorage.removeItem('user');
          localStorage.removeItem('expiresAt');
          
          // Redirect to login
          window.location.href = '/login.html';
        }
      });

      // Check authentication on page load
      if (checkAuthentication()) {
        loadUserInfo();
      }
    </script>

    <script src="app.js"></script>
  </body>
</html>

